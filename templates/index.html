<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¿’æ…£åŒ–ã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>ğŸŒ± ç¿’æ…£åŒ–ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>

  {% if data.habit %}
    <p><strong>ç¿’æ…£ï¼š</strong>{{ data.habit }}</p>
    <form method="POST">
      <button type="submit" name="done" value="1">ä»Šæ—¥ã‚„ã£ãŸï¼</button>
    </form>
    <p>âœ… é”æˆæ—¥æ•°ï¼š{{ data.log | length }} æ—¥</p>
    <p>ğŸ”¥ é€£ç¶šé”æˆæ—¥æ•°ï¼š{{ streak }} æ—¥</p>
    <p>ğŸ“Š ä»Šæœˆã®é”æˆç‡ï¼š{{ achievement_rate }}%</p>
    <h2>ğŸ“… {{ year }}å¹´{{ month }}æœˆã®é”æˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>

<p>
  {% set prev_month = month - 1 %}
  {% set prev_year = year %}
  {% if prev_month == 0 %}
    {% set prev_month = 12 %}
    {% set prev_year = year - 1 %}
  {% endif %}

  {% set next_month = month + 1 %}
  {% set next_year = year %}
  {% if next_month == 13 %}
    {% set next_month = 1 %}
    {% set next_year = year + 1 %}
  {% endif %}

  <a href="/?year={{ prev_year }}&month={{ prev_month }}">â† å‰ã®æœˆ</a>
  |
  <a href="/?year={{ next_year }}&month={{ next_month }}">æ¬¡ã®æœˆ â†’</a>
</p>

  <table border="1" style="margin: 0 auto; border-collapse: collapse;">
    <tr>
      <th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th>
    </tr>
    {% for week in calendar_weeks %}
      <tr>
        {% for day in week %}
          <td style="padding: 8px; width: 40px; text-align: center;">
            {% if day.day %}
              {{ day.day }}<br>
              {% if day.done %}
                âœ”
              {% endif %}
            {% endif %}
          </td>
        {% endfor %}
      </tr>
    {% endfor %}
  </table>

{% else %}
    <form method="POST">
      <input type="text" name="habit" placeholder="ç¿’æ…£ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šæ¯æœã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‰" required>
      <button type="submit">è¨­å®š</button>
    </form>
  {% endif %}


  <!-- âœ… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
window.addEventListener("DOMContentLoaded", () => {
  {% if celebrate %}
  const msg = document.getElementById("celebrate-message");
  msg.style.display = "block";

  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¿ã‚¤ãƒãƒ¼ä¸¡æ–¹ã§æ¶ˆãˆã‚‹ã‚ˆã†ã«
  const animation = msg.animate(
    [
      { transform: "scale(1)", opacity: 1 },
      { transform: "scale(1.5)", opacity: 0 }
    ],
    {
      duration: 3000,   // 3ç§’é–“è¡¨ç¤º
      easing: "ease-out"
    }
  );

  animation.onfinish = () => {
    msg.style.display = "none";
  };

  // ã¾ã‚Œã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„å ´åˆã‚‚ä¿é™º
  setTimeout(() => {
    msg.style.display = "none";
  }, 3200); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ˆã‚Šã¡ã‚‡ã„é•·ã‚
  {% endif %}
});
</script>

   <!-- âœ… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <div id="celebrate-message">
    <span>ğŸ‰ ã‚ˆãã‚„ã‚Šã¾ã—ãŸï¼</span>
  </div>
</body>
</html>
