<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ç¿’æ…£åŒ–ã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>ğŸŒ± ç¿’æ…£åŒ–ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>
  <button id="toggle-theme">ğŸŒ— ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ</button>
  {% if data.habit %}
    <p><strong>ç¿’æ…£ï¼š</strong>{{ data.habit }}</p>
    <form method="POST">
      <textarea name="memo_text" rows="2" placeholder="ä»Šæ—¥ã®ãƒ¡ãƒ¢ã‚’æ›¸ã">{{ data.memos[today_str] if today_str in data.memos else '' }}</textarea>
      <button type="submit" name="memo" value="1">ğŸ’¬ ãƒ¡ãƒ¢ä¿å­˜</button>
    </form>

    <p>âœ… é”æˆæ—¥æ•°ï¼š{{ data.log | length }} æ—¥</p>
    <p>ğŸ”¥ é€£ç¶šé”æˆæ—¥æ•°ï¼š{{ streak }} æ—¥</p>
    <p>ğŸ“Š ä»Šæœˆã®é”æˆç‡ï¼š{{ achievement_rate }}%</p>
    <h2>ğŸ“… {{ year }}å¹´{{ month }}æœˆã®é”æˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>

<p>
  {% set prev_month = month - 1 %}
  {% set prev_year = year %}
  {% if prev_month == 0 %}
    {% set prev_month = 12 %}
    {% set prev_year = year - 1 %}
  {% endif %}

  {% set next_month = month + 1 %}
  {% set next_year = year %}
  {% if next_month == 13 %}
    {% set next_month = 1 %}
    {% set next_year = year + 1 %}
  {% endif %}

  <a href="/?year={{ prev_year }}&month={{ prev_month }}">â† å‰ã®æœˆ</a>
  |
  <a href="/?year={{ next_year }}&month={{ next_month }}">æ¬¡ã®æœˆ â†’</a>
</p>

  <table border="1" style="margin: 0 auto; border-collapse: collapse;">
    <tr>
      <th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th>
    </tr>
    {% for week in calendar_weeks %}
  <tr>
    {% for day in week %}
      {% if day.day %}
        <td onclick="location.href='/?selected_date={{ year }}-{{ '{:02d}'.format(month) }}-{{ '{:02d}'.format(day.day) }}'"
            style="cursor: pointer; padding: 8px; width: 40px; text-align: center;">
          {{ day.day }}<br>
          {% if day.done %}âœ”{% endif %}
          {% if day.has_memo %}ğŸ“{% endif %}
        </td>
      {% else %}
        <td style="padding: 8px; width: 40px;">&nbsp;</td>
      {% endif %}
    {% endfor %}
  </tr>
{% endfor %}

  </table>

  {% if selected_date and selected_memo %}
    <div style="margin-top: 1em; border: 1px solid #ccc; padding: 1em;">
      <h3>ğŸ“ {{ selected_date }} ã®ãƒ¡ãƒ¢</h3>
      <p>{{ selected_memo }}</p>
    </div>
{% elif selected_date %}
  <div style="margin-top: 1em;">
    <p>{{ selected_date }} ã®ãƒ¡ãƒ¢ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  </div>
{% endif %}

{% else %}
    <form method="POST">
      <input type="text" name="habit" placeholder="ç¿’æ…£ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šæ¯æœã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‰" required>
      <button type="submit">è¨­å®š</button>
    </form>
  {% endif %}


  <!-- âœ… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
window.addEventListener("DOMContentLoaded", () => {
  {% if celebrate %}
  const msg = document.getElementById("celebrate-message");
  msg.style.display = "block";

  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¿ã‚¤ãƒãƒ¼ä¸¡æ–¹ã§æ¶ˆãˆã‚‹ã‚ˆã†ã«
  const animation = msg.animate(
    [
      { transform: "scale(1)", opacity: 1 },
      { transform: "scale(1.5)", opacity: 0 }
    ],
    {
      duration: 3000,   // 3ç§’é–“è¡¨ç¤º
      easing: "ease-out"
    }
  );

  animation.onfinish = () => {
    msg.style.display = "none";
  };

  // ã¾ã‚Œã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„å ´åˆã‚‚ä¿é™º
  setTimeout(() => {
    msg.style.display = "none";
  }, 3200); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ˆã‚Šã¡ã‚‡ã„é•·ã‚
  {% endif %}
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggleButton = document.getElementById("toggle-theme");
  const currentTheme = localStorage.getItem("theme") || "light";
  document.body.classList.add(currentTheme);

  toggleButton.addEventListener("click", () => {
    const isDark = document.body.classList.contains("dark");
    const newTheme = isDark ? "light" : "dark";
    document.body.classList.remove("light", "dark");
    document.body.classList.add(newTheme);
    localStorage.setItem("theme", newTheme);
  });
});
</script>

   <!-- âœ… ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <div id="celebrate-message">
    <span>ğŸ‰ ã‚ˆãã‚„ã‚Šã¾ã—ãŸï¼</span>
  </div>
</body>
</html>